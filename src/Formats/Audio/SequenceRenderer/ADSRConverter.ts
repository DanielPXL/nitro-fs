export class ADSRConverter {
	public static readonly TICK_INTERVAL = ((64 * 2728) / 33000000);

	private static readonly ATTACKRATE_TO_NUMCYCLES_TABLE = [
		1653, 914, 642, 499, 410, 348, 303, 270,
		242, 220, 202, 186, 173, 162, 152, 144,
		136, 129, 122, 116, 112, 106, 102, 98,
		94, 91, 87, 85, 81, 79, 77, 75,
		72, 70, 68, 66, 64, 63, 61, 60,
		58, 57, 56, 54, 53, 52, 51, 50,
		49, 48, 47, 46, 45, 44, 43, 42,
		42, 41, 40, 40, 39, 39, 38, 38,
		36, 36, 35, 35, 34, 34, 33, 33,
		32, 32, 31, 31, 30, 30, 29, 29,
		29, 29, 28, 28, 28, 26, 26, 26,
		25, 25, 25, 25, 24, 24, 24, 23,
		23, 23, 23, 22, 22, 22, 22, 22,
		21, 21, 21, 21, 20, 19, 18, 17,
		16, 15, 14, 13, 12, 11, 10, 9,
		8, 7, 6, 5, 4, 3, 3, 1
	]

	public static convertAttack(attackRate: number): number {
		return ADSRConverter.TICK_INTERVAL * ADSRConverter.ATTACKRATE_TO_NUMCYCLES_TABLE[attackRate];
	}

	private static readonly FALLRATE_TO_REAL_FALLRATE_TABLE = [
		1, 3, 5, 7, 9, 11, 13, 15,
		17, 19, 21, 23, 25, 27, 29, 31,
		33, 35, 37, 39, 41, 43, 45, 47,
		49, 51, 53, 55, 57, 59, 61, 63,
		65, 67, 69, 71, 73, 75, 77, 79,
		81, 83, 85, 87, 89, 91, 93, 95,
		97, 99, 101, 102, 104, 105, 107, 108,
		110, 111, 113, 115, 116, 118, 120, 122,
		124, 126, 128, 130, 132, 135, 137, 140,
		142, 145, 148, 151, 154, 157, 160, 163,
		167, 171, 175, 179, 183, 187, 192, 197,
		202, 208, 213, 219, 226, 233, 240, 248,
		256, 265, 274, 284, 295, 307, 320, 334,
		349, 366, 384, 404, 427, 452, 480, 512,
		549, 591, 640, 698, 768, 853, 960, 1097,
		1280, 1536, 1920, 2560, 3840, 7680, 15360, 65535
	]

	public static convertDecay(fallRate: number): number {
		return ADSRConverter.TICK_INTERVAL * (92544 / ADSRConverter.FALLRATE_TO_REAL_FALLRATE_TABLE[fallRate]);
	}

	public static convertRelease(fallRate: number, amplitudeAtStop: number): number {
		return ADSRConverter.TICK_INTERVAL * ((92544 + amplitudeAtStop) / ADSRConverter.FALLRATE_TO_REAL_FALLRATE_TABLE[fallRate]);
	}

	private static readonly SUSTAIN_TABLE = [
		-92544, -92416, -92288, -83328, -76928, -71936, -67840, -64384,
		-61440, -58880, -56576, -54400, -52480, -50688, -49024, -47488,
		-46080, -44672, -43392, -42240, -41088, -40064, -39040, -38016,
		-36992, -36096, -35328, -34432, -33664, -32896, -32128, -31360,
		-30592, -29952, -29312, -28672, -28032, -27392, -26880, -26240,
		-25728, -25088, -24576, -24064, -23552, -23040, -22528, -22144,
		-21632, -21120, -20736, -20224, -19840, -19456, -19072, -18560,
		-18176, -17792, -17408, -17024, -16640, -16256, -16000, -15616,
		-15232, -14848, -14592, -14208, -13952, -13568, -13184, -12928,
		-12672, -12288, -12032, -11648, -11392, -11136, -10880, -10496,
		-10240, -9984, -9728, -9472, -9216, -8960, -8704, -8448,
		-8192, -7936, -7680, -7424, -7168, -6912, -6656, -6400,
		-6272, -6016, -5760, -5504, -5376, -5120, -4864, -4608,
		-4480, -4224, -3968, -3840, -3584, -3456, -3200, -2944,
		-2816, -2560, -2432, -2176, -2048, -1792, -1664, -1408,
		-1280, -1024, -896, -768, -512, -384, -128, 0
	]

	public static convertSustain(sustain: number): number {
		return ADSRConverter.SUSTAIN_TABLE[sustain];
	}
}