export class ADSRConverter {
	public static readonly TICK_INTERVAL = ((64 * 2728) / 33000000);

	private static readonly ATTACKRATE_TO_NUMCYCLES_TABLE = [
		1653, 914, 642, 499, 410, 348, 303, 270,
		242, 220, 202, 186, 173, 162, 152, 144,
		136, 129, 122, 116, 112, 106, 102, 98,
		94, 91, 87, 85, 81, 79, 77, 75,
		72, 70, 68, 66, 64, 63, 61, 60,
		58, 57, 56, 54, 53, 52, 51, 50,
		49, 48, 47, 46, 45, 44, 43, 42,
		42, 41, 40, 40, 39, 39, 38, 38,
		36, 36, 35, 35, 34, 34, 33, 33,
		32, 32, 31, 31, 30, 30, 29, 29,
		29, 29, 28, 28, 28, 26, 26, 26,
		25, 25, 25, 25, 24, 24, 24, 23,
		23, 23, 23, 22, 22, 22, 22, 22,
		21, 21, 21, 21, 20, 19, 18, 17,
		16, 15, 14, 13, 12, 11, 10, 9,
		8, 7, 6, 5, 4, 3, 3, 1
	]

	public static convertAttack(attackRate: number): number {
		return ADSRConverter.TICK_INTERVAL * ADSRConverter.ATTACKRATE_TO_NUMCYCLES_TABLE[attackRate];
	}

	private static readonly FALLRATE_TO_NUMCYCLES_TABLE = [
		592544, 30848, 18508.8, 13220.57142857143, 10282.666666666666, 8413.09090909091, 7118.7692307692305, 6169.6,
		5443.764705882353, 4870.736842105263, 4406.857142857143, 4023.6521739130435, 3701.76, 3427.5555555555557, 3191.1724137931033, 2985.2903225806454,
		2804.3636363636365, 2644.114285714286, 2501.189189189189, 2372.923076923077, 2257.170731707317, 2152.186046511628, 2056.5333333333333, 1969.0212765957447,
		1888.6530612244899, 1814.5882352941176, 1746.1132075471698, 1682.6181818181817, 1623.578947368421, 1568.542372881356, 1517.1147540983607, 1468.952380952381,
		1423.753846153846, 1381.2537313432836, 1341.2173913043478, 1303.4366197183099, 1267.7260273972602, 1233.92, 1201.8701298701299, 1171.4430379746836,
		1142.5185185185185, 1114.987951807229, 1088.7529411764706, 1063.7241379310344, 1039.8202247191011, 1016.967032967033, 995.0967741935484, 974.1473684210526,
		954.0618556701031, 934.7878787878788, 916.2772277227723, 907.2941176470588, 898.4854368932039, 881.3714285714286, 873.0566037735849, 856.8888888888889,
		849.0275229357799, 833.7297297297297, 826.2857142857143, 811.7894736842105, 797.7931034482758, 784.271186440678, 771.2, 764.8264462809917,
		752.390243902439, 740.352, 723, 711.876923076923, 701.0909090909091, 690.6268656716418, 675.5036496350365, 665.7841726618705,
		651.7183098591549, 642.6666666666666, 629.5510204081633, 616.96, 604.8627450980392, 593.2307692307693, 578.4, 567.7546012269938,
		557.4939759036145, 544.3764705882353, 531.8620689655172, 519.9101123595506, 508.4835164835165, 494.88770053475935, 482, 472.16326530612247,
		458.13861386138615, 447.07246376811594, 434.4788732394366, 422.5753424657534, 411.3066666666667, 398.8965517241379, 385.6, 374.67206477732793,
		361.5, 350.54545454545456, 337.75182481751824, 325.85915492957747, 313.7084745762712, 301.44625407166126, 289.2, 277.9099099099099,
		265.16905444126076, 253.54520547945205, 241, 229.06930693069307, 217.2394366197183, 205.19733924611972, 192.8, 180.75,
		168.87591240875912, 156.8542372881356, 144.6, 132.58452722063038, 120.5, 108.4923798358734, 96.4, 84.36098450319052,
		72.3, 60.25, 48.2, 36.15, 24.1, 12.05, 6.025, 1.4121309224078737
	]

	public static convertFall(fallRate: number): number {
		return ADSRConverter.TICK_INTERVAL * ADSRConverter.FALLRATE_TO_NUMCYCLES_TABLE[fallRate];
	}

	private static readonly SUSTAIN_TABLE = [
		-92544, -92416, -92288, -83328, -76928, -71936, -67840, -64384,
		-61440, -58880, -56576, -54400, -52480, -50688, -49024, -47488,
		-46080, -44672, -43392, -42240, -41088, -40064, -39040, -38016,
		-36992, -36096, -35328, -34432, -33664, -32896, -32128, -31360,
		-30592, -29952, -29312, -28672, -28032, -27392, -26880, -26240,
		-25728, -25088, -24576, -24064, -23552, -23040, -22528, -22144,
		-21632, -21120, -20736, -20224, -19840, -19456, -19072, -18560,
		-18176, -17792, -17408, -17024, -16640, -16256, -16000, -15616,
		-15232, -14848, -14592, -14208, -13952, -13568, -13184, -12928,
		-12672, -12288, -12032, -11648, -11392, -11136, -10880, -10496,
		-10240, -9984, -9728, -9472, -9216, -8960, -8704, -8448,
		-8192, -7936, -7680, -7424, -7168, -6912, -6656, -6400,
		-6272, -6016, -5760, -5504, -5376, -5120, -4864, -4608,
		-4480, -4224, -3968, -3840, -3584, -3456, -3200, -2944,
		-2816, -2560, -2432, -2176, -2048, -1792, -1664, -1408,
		-1280, -1024, -896, -768, -512, -384, -128, 0
	]

	public static convertSustain(sustain: number): number {
		return ADSRConverter.SUSTAIN_TABLE[sustain];
	}
}